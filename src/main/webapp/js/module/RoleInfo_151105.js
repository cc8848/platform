define("module/RoleInfo",["lib/jquery","util/artTemplate","module/Dialog","module/Validator","util/ajaxPromise"],function(e){"use strict";var l,t,o,a,i,s,n,c,r,d;return l=e("lib/jquery"),o=e("util/artTemplate"),t=e("module/Dialog"),a=e("module/Validator"),i=e("util/ajaxPromise"),r=o.compile(['<div class="form-horizontal">','<div class="form-group">','<label class="col-sm-4 control-label">角色名：</label>','<div class="col-sm-8">','<input type="text" value="{{roleName}}" class="role-name form-control" maxLength="30"/>',"</div>","</div>",'<div class="form-group">','<label class="col-sm-4 control-label">roleKey：</label>','<div class="col-sm-8">','<input type="text" value="{{roleSign}}" class="role-sign form-control" maxLength="30"/>',"</div>","</div>",'<div class="form-group">','<label class="col-sm-4 control-label">描述：</label>','<div class="col-sm-8">','<input type="text" value="{{description}}" class="description form-control" maxLength="30"/>',"</div>","</div>",'<div class="form-group">','<div class="col-sm-offset-4 col-sm-8">','<div class="checkbox">','<label><input class="status" type="checkbox" {{if status}}checked{{/if}}>&nbsp;禁用</label>',"</div>","</div>","</div>","</div>"].join("")),d=o.compile(["{{each menu}}","{{if $index === 0 || $index < menu.length - 1 && $value.level <= lastLevel}}","<tr>","{{/if}}",'<td{{if $value.type === 0}} rowspan="{{$value.leafNum}}"{{/if}}>','<div class="checkbox">','<label title={{$value.description}}><input type="checkbox" class="menu-check" data-index="{{$value.levelTree}}" data-id="{{$value.id}}"{{if $value.hasRole}} checked{{/if}}>{{$value.name}}</label>',"</div>","</td>","{{if $value.type === 1 || $value.leafNum === 0}}","</tr>","{{/if}}","{{if lastLevel = $value.level}}{{/if}}","{{/each}}"].join("")),n=function(e){var l,t,o,a,i,s,n=[];for(e=e||[],l=0,t=e.length;t>l;++l)if(a=e[l],i=a.level-1,s=1===a.type)for(o=0;i>o;++o)n[o].leafNum++;else a.leafNum=0,n[i]=a},c=new t("modal-dialog"),s={addRole:function(e){c.show({sizeClass:"modal-sm",title:"创建角色",content:['<div class="form-horizontal">','<div class="form-group">','<label class="col-sm-4 control-label">角色名：</label>','<div class="col-sm-8">','<input type="text" value="" class="role-name form-control" maxLength="30" placeholder="请输入角色名"/>',"</div>","</div>",'<div class="form-group">','<label class="col-sm-4 control-label">roleKey：</label>','<div class="col-sm-8">','<input type="text" value="" class="role-sign form-control" maxLength="30" placeholder="请输入roleKey"/>',"</div>","</div>",'<div class="form-group">','<label class="col-sm-4 control-label">描述：</label>','<div class="col-sm-8">','<input type="text" value="" class="description form-control" maxLength="30" placeholder="请输入角色描述"/>',"</div>","</div>",'<div class="form-group">','<div class="col-sm-offset-4 col-sm-8">','<div class="checkbox">','<label><input class="status" type="checkbox" checked>&nbsp;禁用</label>',"</div>","</div>","</div>","</div>"].join(""),source:e,confirm:function(){var e,l,t,o=this,s={},n=new a;return e=o._container,l=e.find(".role-name"),s.roleName=l.val().trim(),t=e.find(".role-sign"),s.roleSign=t.val().trim(),n.add(s.roleName,"isNotEmpty",function(){alert("请输入角色名"),l.val("").focus()}).add(s.roleSign,"isNotEmpty",function(){alert("请输入roleKey"),t.val("").focus()}),n.start()?(s.description=e.find(".description").val().trim(),s.status=e.find(".status").prop("checked")?1:0,void i({url:window.basePath+"role/addRole",type:"POST",data:s,dataType:"json"}).then(function(e){document.location.reload()},function(){o.enableConfirm()})):void o.enableConfirm()}})},editRole:function(e){c.show({sizeClass:"modal-sm",title:"编辑角色",content:r(e),force:1,confirm:function(){var l,t,o,s,n=this,c=new a;return t={id:e.id},l=n._container,o=l.find(".role-name"),t.roleName=o.val().trim(),s=l.find(".role-sign"),t.roleSign=s.val().trim(),c.add(t.roleName,"isNotEmpty",function(){alert("请输入角色名"),o.val("").focus()}).add(t.roleSign,"isNotEmpty",function(){alert("请输入roleKey"),s.val("").focus()}),c.start()?(t.description=l.find(".description").val().trim(),t.status=l.find(".status").prop("checked")?1:0,void i({url:window.basePath+"role/updateRole",type:"POST",data:t,dataType:"json"}).then(function(e){document.location.reload()},function(){n.enableConfirm()})):void n.enableConfirm()}})},authority:function(e){i({url:window.basePath+"resources/listJson",type:"GET",data:{roleId:e},dataType:"json"}).then(function(t){var o;o=t.result,n(o),c.show({sizeClass:"modal-lg",title:"角色授权",content:['<div class="table-scroll">','<table class="table table-bordered table-middle">',"<thead>","<tr>",'<th class="min-w200">一级目录</th>','<th class="min-w200">二级目录</th>','<th class="min-w200">三级目录</th>','<th class="min-w200">四级目录</th>',"</tr>","</thead>",'<tbody class="menu-list"></tbody>',"</table>","</div>"].join(""),force:1,renderCall:function(){var e,t=this;e=t._body.find(".menu-list"),e.html(d({menu:o})),t.checkList=e.find(".menu-check"),t._body.on("click.bs.custom",".menu-check",function(e){var o,a,i,s,n,c=l(this),r=[];if(s=c.prop("checked"),o=c.data("index")+"",s){for(a=o.split("-"),a.pop();a.length;)i=a.join("-"),n=t.checkList.filter("[data-index="+i+"]")[0],n&&r.push(n),a.pop();l(r).prop("checked",!0)}t.checkList.filter("[data-index^="+o+"-]").prop("checked",s)}).on("hide.bs.modal",function(e){delete t.checkList})},confirm:function(){var t=this;i({url:window.basePath+"role/authentic",type:"POST",data:{roleId:e,resId:t.checkList.filter(":checked").map(function(e){return l(this).data("id")}).get().join()},dataType:"json"}).then(function(e){alert("授权完成"),document.location.reload()},function(){t.enableConfirm()})}})})}}});